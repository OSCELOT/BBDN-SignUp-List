<!DOCTYPE html>
<html ng-app="signupApp">
  <head>
    <title>SignUp List</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/spacelab/bootstrap.min.css" rel="stylesheet" integrity="sha384-L/tgI3wSsbb3f/nW9V6Yqlaw3Gj7mpE56LWrhew/c8MIhAYWZ/FNirA64AVkB5pI" crossorigin="anonymous">
  </head>
  <body ng-controller="SignupController" data-ng-init="getData()">
    <!-- Signups View -->
    <nav class="navbar navbar-default">
      <div class="container-fluid"  ng-show="config.lti && course && user">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <h1 class="navbar-brand mb-0" style="margin-top: 0px">SignUp List</h1>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul ng-if="config.lti.user_role === 'urn:lti:role:ims/lis/Instructor'" class="nav navbar-nav">
            <li><button class="btn btn-outline-default" style="margin-top:6px" type="button" ng-click="config.addList = true">New List</button></li>
            <!--<li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">List Tools <span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li><a href="#">Edit</a></li>
                <li><a href="#">Print</a></li>
                <li><a href="#">Email List</a></li>
                <li><a href="#">Create Group</a></li>
                <li role="separator" class="divider"></li>
                <li><a href="#">Add User</a></li>
                <li><a href="#">Remove User</a></li>
              </ul>
            </li>-->
          </ul>
          <p class="navbar-text navbar-right"><a href="{{config.lti.return_url}}"><span class="glyphicon glyphicon-off" aria-hidden="true"></span></a></p>
          <p class="navbar-text navbar-right">Signed in as {{user.name.given}} {{user.name.family}}</p>
          <p class="navbar-text navbar-right">Course:</strong> {{course.name}}</p>
        </div><!-- /.navbar-collapse -->
      </div><!-- /.container-fluid -->
    </nav>
    <div class="container-fluid">
      <div ng-show="config.addList">
        <form novalidate >
          <div class="form-group dropdown">
            <label for="name" class="col-2 col-form-label">Name</label>
            <div class="col-10">
              <input class="form-control" type="text" id="name" ng-model="list.name" />
            </div>
          </div>
          <div class="form-group dropdown">
            <label for="description" class="col-2 col-form-label">Description</label>
            <div class="col-10">
              <input class="form-control" type="text" id="description" ng-model="list.description" />
            </div>
          </div>
          <div class="form-group dropdown">
            <label for="location" class="col-2 col-form-label">Location</label>
            <div class="col-10">
              <input class="form-control" type="text" id="location" ng-model="list.location" />
            </div>
          </div>
          <div class="dropdown form-group">
            <label>Start Date</label>
            <a class="dropdown-toggle" id="dropdownStart" role="button" data-toggle="dropdown" data-target="#"
               href="#">
                <div class="input-group date">
                    <input type="text" class="form-control" data-ng-model="list.start">
                    <span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span>
                </div>
            </a>
            <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
                <datetimepicker data-ng-model="dateRangeStart"
                                data-datetimepicker-config="{ dropdownSelector: '#dropdownStart', renderOn: 'end-date-changed' }"
                                data-on-set-time="startDateOnSetTime()"
                                data-before-render="startDateBeforeRender($dates)"></datetimepicker>
            </ul>
          </div>

          <div class="dropdown form-group">
            <label>End Date</label>
            <a class="dropdown-toggle" id="dropdownEnd" role="button" data-toggle="dropdown" data-target="#"
               href="#">
                <div class="input-group date">
                    <input type="text" class="form-control" data-ng-model="list.end">
                    <span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span>
                </div>
            </a>
            <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
                <datetimepicker data-ng-model="dateRangeEnd"
                                data-datetimepicker-config="{ dropdownSelector: '#dropdownEnd', renderOn: 'start-date-changed' }"
                                data-on-set-time="endDateOnSetTime()"
                                data-before-render="endDateBeforeRender($view, $dates, $leftDate, $upDate, $rightDate)"></datetimepicker>
            </ul>
          </div>
          <div class="form-group dropdown">
            <label for="max-size" class="col-2 col-form-label">Maximum Members</label>
            <div class="col-10">
              <input class="form-control" type="number" id="max-size" ng-model="list.max_size">
            </div>
          </div>
          <div class="form-check">
            <label class="form-check-label">
              <input class="form-check-input" type="checkbox" value="waitlist_allowed" ng-model="list.waitlist_allowed">
              Allow Waitlist
            </label>
          </div>
          <div class="form-group dropdown" ng-show="list.waitlist_allowed">
            <label for="max-waitlist" class="col-2 col-form-label">Maximum Waitlist</label>
            <div class="col-10">
              <input class="form-control" type="number" id="max-waitlist" ng-model="list.max_waitlist">
            </div>
          </div>
          <div class="form-check">
            <label class="form-check-label">
              <input class="form-check-input" type="checkbox" value="student_view" ng-model="list.student_view">
              Allow Students To View Memberships
            </label>
          </div>
          <div class="form-group dropdown">
            <label for="group-name" class="col-2 col-form-label">Group Name</label>
            <div class="col-10">
              <input class="form-control" type="text" id="group-name" ng-model="list.group">
            </div>
          </div>
          <input class="btn btn-default" type="button" ng-click="config.addList = false" value="Cancel" />
          <input class="btn btn-default" type="submit" ng-click="addList()" value="Save" />
        </form>
      </div>

      <div id="printMe" ng-repeat="list in course.lists">
        <div class="panel" ng-class="list.taken < list.total ? 'panel-default' : 'panel-danger'">
          <div class="panel-heading clearfix">
            <div class="row">
              <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 text-left">{{list.name}}</div>
              <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 text-center">{{calculateTaken(list, true)}}/{{list.max_size}} places free</div>
              <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 text-right">{{reserveSpaces(list)}} reserve places</div>
            </div>
          </div>
          <div class="panel-body">
            <div class="row">
              <div class="col-lg-9 col-md-9 col-sm-9 col-xs-9">
                <div>
                  <div>{{list.description}}</div>
                  <div>{{list.location}}</div>
                </div>
                <div ng-show="permissions.viewMembers || config.lti.user_role === 'urn:lti:role:ims/lis/Instructor'">
                  <button class="btn btn-default" ng-show="!list.showMembers" ng-click="list.showMembers = true">View Members</button>
                  <button class="btn btn-default" ng-show="list.showMembers" ng-click="list.showMembers = false">Hide Members</button>
                </div>
                <div ng-show="list.showMembers">
                  <table class="table table-responsive">
                    <thead class="thead-default">
                      <tr>
                        <th>First Name</th>
                        <th>Last Name</th>
                        <th>Email</th>
                        <th>Role</th>
                        <th>Group</th>
                        <th>Date Joined</th>
                        <th>Added By</th>
                      </tr>
                    </thead>
                    <tbody ng-repeat="member in list.members">
                      <tr>
                        <th scope="row">{{member.first}}</th>
                        <td>{{member.last}}</td>
                        <td>{{member.email}}</td>
                        <td>{{member.role}}</td>
                        <td>{{member.groupState}}</td>
                        <td>{{member.created | date}}</td>
                        <td>{{member.addedBy}}</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
              <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3" style="text-align:right;">
                <div class="btn-group-vertical" ng-show="config.lti.user_role === 'urn:lti:role:ims/lis/Instructor'">
                  <button class="btn btn-default" ng-click="createGroup(list)">Create Group</button>
                  <button class="btn btn-default" ng-click="addUser(list)">Add User</button>
                  <button class="btn btn-default" ng-click="delUser(list)">Remove User</button>
                  <button class="btn btn-default" ng-click="emailList(list)">Email List</button>
                  <button ng-print print-element-id="printMe" class="btn btn-default" >Print List</button>
                  <button class="btn btn-default" ng-click="exportList(list)">Export List</button>
                </div>
                <div ng-show="config.lti.user_role === 'urn:lti:role:ims/lis/Learner'">
                  <button ng-class="list.taken < list.total ? 'btn btn-default' : 'btn btn-default disabled'"ng-show="!userInList(list)" ng-click="addMe()">Join</button>
                  <button class="btn" ng-show="userInList(list)" ng-click="delMe()">Unjoin</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
        <!-- <div class="row">
          <div class="col-md-9">
            <div class="row">
              <div class="col-sm-3"><h2>{{list.name}}</h2></div>
              <div class="col-sm-3" style="text-align:center;">{{list.taken}}/{{list.total}} places free</div>
              <div class="col-sm-3" style="text-align:right;"><span style="color:red;">{{reserveSpaces(list)}} reserve places</span></div>
            </div>
            <div>
              <div>{{list.description}}</div>
              <div>{{list.location}}</div>
            </div>
            <div ng-show="permissions.viewMembers || lti.user_role === 'urn:lti:role:ims/lis/Instructor'">
              <button style="width: 125px;" ng-show="!list.showMembers" ng-click="list.showMembers = true">View Members</button>
              <button style="width: 125px;" ng-show="list.showMembers" ng-click="list.showMembers = false">Hide Members</button>
            </div>
            <div ng-show="list.showMembers">
              <table class="table table-responsive">
                <thead class="thead-default">
                  <tr>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Email</th>
                    <th>Role</th>
                    <th>Group</th>
                    <th>Date Joined</th>
                    <th>Added By</th>
                  </tr>
                </thead>
                <tbody ng-repeat="member in list.members">
                  <tr>
                    <th scope="row">{{member.first}}</th>
                    <td>{{member.last}}</td>
                    <td>{{member.email}}</td>
                    <td>{{member.role}}</td>
                    <td>{{member.groupState}}</td>
                    <td>{{member.created | date}}</td>
                    <td>{{member.addedBy}}</td>
                  </tr>
                </tbody>
              </table>
              </div>
            </div>
            <div class="col-md-3" style="text-align:right;">
              <div ng-show="lti.user_role === 'urn:lti:role:ims/lis/Instructor'">
                <button style="width: 125px;" ng-click="print(list)">Print List</button><br />
                <button style="width: 125px;" ng-click="exportList(list)">Export List</button><br />
                <button style="width: 125px;" ng-click="createGroup(list)">Create Group</button><br />
                <button style="width: 125px;" ng-click="addUser(list)">Add User</button><br />
                <button style="width: 125px;" ng-click="delUser(list)">Remove User</button>
              </div>
              <div ng-show="lti.user_role === 'urn:lti:role:ims/lis/Learner'">
                <button style="width: 125px;" ng-show="!userInList(list)" ng-click="addMe()">Join</button><br />
                <button style="width: 125px;" ng-show="userInList(list)" ng-click="delMe()">Unjoin</button>
              </div>
            </div>
          </div>
        </div> -->
        <div ng-show="!config.lti || !course || !user">
          <p>Loading...</p>
        </div>
      </div>

      <div ng-if="config.debug_mode">
        <div ng-show="config.lti">
          <h1>Here is the provided LTI data</h1>
          <ul>
            <li>Course UUID : {{config.lti.course_uuid}}</li>
            <li>User UUID : {{config.lti.user_uuid}}</li>
            <li>User Role : {{config.lti.user_role}}</li>
            <li>System GUID : {{config.lti.system_guid}}</li>
            <li>Host : {{config.lti.rest_host}}</li>
            <li>Port : {{config.lti.rest_port}}</li>
            <li>Return URL : {{config.lti.return_url}}</li>
          </ul>
        </div>
        <div ng-show="course">
          <h4>Course</h4>
          <pre>{{course | json}}</pre>
        </div>
        <div ng-show="user">
          <h4>User</h4>
          <pre>{{user | json}}</pre>
        </div>
        <h4>Lists</h4>
        <pre>{{lists | json}}</pre>

        <h4>Permissions</h4>
        <pre>{{permissions | json}}</pre>
      </div>
      <!-- <div ng-controller="SignUpSummaryController">
        <summary-view></summary-view>
      </div> -->
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.23/angular-resource.min.js"></script>
    <script type="text/javascript" src="/../node_modules/angular-bootstrap-datetimepicker/src/js/datetimepicker.templates.js"></script>

    <script src="./app.js"></script>
    <script src="./controllers/signup-controller.js"></script>
    <script src="./services/api-service.js"></script>
    <script src="./services/db-service.js"></script>
    <script src="./services/lti-service.js"></script>
    <script src="./services/list-service.js"></script>
    <script src="./directives/summary-view.js"></script>
  </body>
</html>
